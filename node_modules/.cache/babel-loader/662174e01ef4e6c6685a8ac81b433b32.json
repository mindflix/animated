{"ast":null,"code":"import _slicedToArray from \"/Users/yolo/Documents/dev/js/animated/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/yolo/Documents/dev/js/animated/src/diamonds/Diamonds.js\";\nimport { WebGLRenderTarget, Object3D } from \"three\";\nimport React, { useRef, useMemo } from \"react\";\nimport { useLoader, useThree, useFrame } from \"react-three-fiber\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport lerp from \"lerp\";\nimport BackfaceMaterial from \"./BackfaceMaterial\";\nimport RefractionMaterial from \"./RefractionMaterial\";\nimport { useBlock } from \"../blocks\";\nimport state from \"../store\";\nvar dummy = new Object3D();\nexport default function Diamonds() {\n  var gltf = useLoader(GLTFLoader, \"/diamond.glb\");\n  useMemo(function () {\n    return gltf.scene.children[0].geometry.center();\n  }, []);\n\n  var _useThree = useThree(),\n      size = _useThree.size,\n      gl = _useThree.gl,\n      scene = _useThree.scene,\n      camera = _useThree.camera,\n      clock = _useThree.clock;\n\n  var _useBlock = useBlock(),\n      contentMaxWidth = _useBlock.contentMaxWidth,\n      sectionHeight = _useBlock.sectionHeight,\n      mobile = _useBlock.mobile;\n\n  var model = useRef();\n  var ratio = gl.getPixelRatio();\n\n  var _useMemo = useMemo(function () {\n    var envFbo = new WebGLRenderTarget(size.width * ratio, size.height * ratio);\n    var backfaceFbo = new WebGLRenderTarget(size.width * ratio, size.height * ratio);\n    var backfaceMaterial = new BackfaceMaterial();\n    var refractionMaterial = new RefractionMaterial({\n      envMap: envFbo.texture,\n      backfaceMap: backfaceFbo.texture,\n      resolution: [size.width * ratio, size.height * ratio]\n    });\n    return [envFbo, backfaceFbo, backfaceMaterial, refractionMaterial];\n  }, [size, ratio]),\n      _useMemo2 = _slicedToArray(_useMemo, 4),\n      envFbo = _useMemo2[0],\n      backfaceFbo = _useMemo2[1],\n      backfaceMaterial = _useMemo2[2],\n      refractionMaterial = _useMemo2[3];\n\n  useFrame(function () {\n    state.diamonds.forEach(function (data, i) {\n      var t = clock.getElapsedTime() / 2;\n      var x = data.x,\n          offset = data.offset,\n          scale = data.scale,\n          factor = data.factor;\n      var s = contentMaxWidth / 35 * scale;\n      data.pos.set(mobile ? 0 : x, lerp(data.pos.y, -sectionHeight * offset * factor + state.top.current / state.zoom * factor, 0.1), 0);\n      dummy.position.copy(data.pos);\n      if (i === state.diamonds.length - 1) dummy.rotation.set(0, t, 0);else dummy.rotation.set(t, t, t);\n      dummy.scale.set(s, s, s);\n      dummy.updateMatrix();\n      model.current.setMatrixAt(i, dummy.matrix);\n      model.current.instanceMatrix.needsUpdate = true;\n    });\n    gl.autoClear = false;\n    camera.layers.set(0);\n    gl.setRenderTarget(envFbo);\n    gl.clearColor();\n    gl.render(scene, camera);\n    gl.clearDepth();\n    camera.layers.set(1);\n    model.current.material = backfaceMaterial;\n    gl.setRenderTarget(backfaceFbo);\n    gl.clearDepth();\n    gl.render(scene, camera);\n    camera.layers.set(0);\n    gl.setRenderTarget(null);\n    gl.render(scene, camera);\n    gl.clearDepth();\n    camera.layers.set(1);\n    model.current.material = refractionMaterial;\n    gl.render(scene, camera);\n  }, 1);\n  return React.createElement(\"instancedMesh\", {\n    ref: model,\n    layers: 1,\n    args: [null, null, state.diamonds.length],\n    position: [0, 0, 50],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69\n    },\n    __self: this\n  }, React.createElement(\"bufferGeometry\", Object.assign({\n    attach: \"geometry\"\n  }, gltf.__$[1].geometry, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70\n    },\n    __self: this\n  })));\n}","map":{"version":3,"sources":["/Users/yolo/Documents/dev/js/animated/src/diamonds/Diamonds.js"],"names":["WebGLRenderTarget","Object3D","React","useRef","useMemo","useLoader","useThree","useFrame","GLTFLoader","lerp","BackfaceMaterial","RefractionMaterial","useBlock","state","dummy","Diamonds","gltf","scene","children","geometry","center","size","gl","camera","clock","contentMaxWidth","sectionHeight","mobile","model","ratio","getPixelRatio","envFbo","width","height","backfaceFbo","backfaceMaterial","refractionMaterial","envMap","texture","backfaceMap","resolution","diamonds","forEach","data","i","t","getElapsedTime","x","offset","scale","factor","s","pos","set","y","top","current","zoom","position","copy","length","rotation","updateMatrix","setMatrixAt","matrix","instanceMatrix","needsUpdate","autoClear","layers","setRenderTarget","clearColor","render","clearDepth","material","__$"],"mappings":";;AAAA,SAASA,iBAAT,EAA4BC,QAA5B,QAA4C,OAA5C;AACA,OAAOC,KAAP,IAAgBC,MAAhB,EAAwBC,OAAxB,QAAuC,OAAvC;AACA,SAASC,SAAT,EAAoBC,QAApB,EAA8BC,QAA9B,QAA8C,mBAA9C;AACA,SAASC,UAAT,QAA2B,uCAA3B;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,gBAAP,MAA6B,oBAA7B;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,SAASC,QAAT,QAAyB,WAAzB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AAEA,IAAMC,KAAK,GAAG,IAAIb,QAAJ,EAAd;AACA,eAAe,SAASc,QAAT,GAAoB;AACjC,MAAMC,IAAI,GAAGX,SAAS,CAACG,UAAD,EAAa,cAAb,CAAtB;AACAJ,EAAAA,OAAO,CAAC;AAAA,WAAMY,IAAI,CAACC,KAAL,CAAWC,QAAX,CAAoB,CAApB,EAAuBC,QAAvB,CAAgCC,MAAhC,EAAN;AAAA,GAAD,EAAiD,EAAjD,CAAP;;AAFiC,kBAIUd,QAAQ,EAJlB;AAAA,MAIzBe,IAJyB,aAIzBA,IAJyB;AAAA,MAInBC,EAJmB,aAInBA,EAJmB;AAAA,MAIfL,KAJe,aAIfA,KAJe;AAAA,MAIRM,MAJQ,aAIRA,MAJQ;AAAA,MAIAC,KAJA,aAIAA,KAJA;;AAAA,kBAKkBZ,QAAQ,EAL1B;AAAA,MAKzBa,eALyB,aAKzBA,eALyB;AAAA,MAKRC,aALQ,aAKRA,aALQ;AAAA,MAKOC,MALP,aAKOA,MALP;;AAMjC,MAAMC,KAAK,GAAGzB,MAAM,EAApB;AACA,MAAM0B,KAAK,GAAGP,EAAE,CAACQ,aAAH,EAAd;;AAPiC,iBASmC1B,OAAO,CAAC,YAAM;AAChF,QAAM2B,MAAM,GAAG,IAAI/B,iBAAJ,CAAsBqB,IAAI,CAACW,KAAL,GAAaH,KAAnC,EAA0CR,IAAI,CAACY,MAAL,GAAcJ,KAAxD,CAAf;AACA,QAAMK,WAAW,GAAG,IAAIlC,iBAAJ,CAAsBqB,IAAI,CAACW,KAAL,GAAaH,KAAnC,EAA0CR,IAAI,CAACY,MAAL,GAAcJ,KAAxD,CAApB;AACA,QAAMM,gBAAgB,GAAG,IAAIzB,gBAAJ,EAAzB;AACA,QAAM0B,kBAAkB,GAAG,IAAIzB,kBAAJ,CAAuB;AAChD0B,MAAAA,MAAM,EAAEN,MAAM,CAACO,OADiC;AAEhDC,MAAAA,WAAW,EAAEL,WAAW,CAACI,OAFuB;AAGhDE,MAAAA,UAAU,EAAE,CAACnB,IAAI,CAACW,KAAL,GAAaH,KAAd,EAAqBR,IAAI,CAACY,MAAL,GAAcJ,KAAnC;AAHoC,KAAvB,CAA3B;AAKA,WAAO,CAACE,MAAD,EAASG,WAAT,EAAsBC,gBAAtB,EAAwCC,kBAAxC,CAAP;AACD,GAV0E,EAUxE,CAACf,IAAD,EAAOQ,KAAP,CAVwE,CAT1C;AAAA;AAAA,MAS1BE,MAT0B;AAAA,MASlBG,WATkB;AAAA,MASLC,gBATK;AAAA,MASaC,kBATb;;AAqBjC7B,EAAAA,QAAQ,CAAC,YAAM;AACbM,IAAAA,KAAK,CAAC4B,QAAN,CAAeC,OAAf,CAAuB,UAACC,IAAD,EAAOC,CAAP,EAAa;AAClC,UAAMC,CAAC,GAAGrB,KAAK,CAACsB,cAAN,KAAyB,CAAnC;AADkC,UAE1BC,CAF0B,GAEGJ,IAFH,CAE1BI,CAF0B;AAAA,UAEvBC,MAFuB,GAEGL,IAFH,CAEvBK,MAFuB;AAAA,UAEfC,KAFe,GAEGN,IAFH,CAEfM,KAFe;AAAA,UAERC,MAFQ,GAEGP,IAFH,CAERO,MAFQ;AAGlC,UAAMC,CAAC,GAAI1B,eAAe,GAAG,EAAnB,GAAyBwB,KAAnC;AACAN,MAAAA,IAAI,CAACS,GAAL,CAASC,GAAT,CAAa1B,MAAM,GAAG,CAAH,GAAOoB,CAA1B,EAA6BtC,IAAI,CAACkC,IAAI,CAACS,GAAL,CAASE,CAAV,EAAa,CAAC5B,aAAD,GAAiBsB,MAAjB,GAA0BE,MAA1B,GAAoCrC,KAAK,CAAC0C,GAAN,CAAUC,OAAV,GAAoB3C,KAAK,CAAC4C,IAA3B,GAAmCP,MAAnF,EAA2F,GAA3F,CAAjC,EAAkI,CAAlI;AACApC,MAAAA,KAAK,CAAC4C,QAAN,CAAeC,IAAf,CAAoBhB,IAAI,CAACS,GAAzB;AACA,UAAIR,CAAC,KAAK/B,KAAK,CAAC4B,QAAN,CAAemB,MAAf,GAAwB,CAAlC,EAAqC9C,KAAK,CAAC+C,QAAN,CAAeR,GAAf,CAAmB,CAAnB,EAAsBR,CAAtB,EAAyB,CAAzB,EAArC,KACK/B,KAAK,CAAC+C,QAAN,CAAeR,GAAf,CAAmBR,CAAnB,EAAsBA,CAAtB,EAAyBA,CAAzB;AACL/B,MAAAA,KAAK,CAACmC,KAAN,CAAYI,GAAZ,CAAgBF,CAAhB,EAAmBA,CAAnB,EAAsBA,CAAtB;AACArC,MAAAA,KAAK,CAACgD,YAAN;AACAlC,MAAAA,KAAK,CAAC4B,OAAN,CAAcO,WAAd,CAA0BnB,CAA1B,EAA6B9B,KAAK,CAACkD,MAAnC;AACApC,MAAAA,KAAK,CAAC4B,OAAN,CAAcS,cAAd,CAA6BC,WAA7B,GAA2C,IAA3C;AACD,KAZD;AAcA5C,IAAAA,EAAE,CAAC6C,SAAH,GAAe,KAAf;AACA5C,IAAAA,MAAM,CAAC6C,MAAP,CAAcf,GAAd,CAAkB,CAAlB;AACA/B,IAAAA,EAAE,CAAC+C,eAAH,CAAmBtC,MAAnB;AACAT,IAAAA,EAAE,CAACgD,UAAH;AACAhD,IAAAA,EAAE,CAACiD,MAAH,CAAUtD,KAAV,EAAiBM,MAAjB;AACAD,IAAAA,EAAE,CAACkD,UAAH;AACAjD,IAAAA,MAAM,CAAC6C,MAAP,CAAcf,GAAd,CAAkB,CAAlB;AACAzB,IAAAA,KAAK,CAAC4B,OAAN,CAAciB,QAAd,GAAyBtC,gBAAzB;AACAb,IAAAA,EAAE,CAAC+C,eAAH,CAAmBnC,WAAnB;AACAZ,IAAAA,EAAE,CAACkD,UAAH;AACAlD,IAAAA,EAAE,CAACiD,MAAH,CAAUtD,KAAV,EAAiBM,MAAjB;AACAA,IAAAA,MAAM,CAAC6C,MAAP,CAAcf,GAAd,CAAkB,CAAlB;AACA/B,IAAAA,EAAE,CAAC+C,eAAH,CAAmB,IAAnB;AACA/C,IAAAA,EAAE,CAACiD,MAAH,CAAUtD,KAAV,EAAiBM,MAAjB;AACAD,IAAAA,EAAE,CAACkD,UAAH;AACAjD,IAAAA,MAAM,CAAC6C,MAAP,CAAcf,GAAd,CAAkB,CAAlB;AACAzB,IAAAA,KAAK,CAAC4B,OAAN,CAAciB,QAAd,GAAyBrC,kBAAzB;AACAd,IAAAA,EAAE,CAACiD,MAAH,CAAUtD,KAAV,EAAiBM,MAAjB;AACD,GAjCO,EAiCL,CAjCK,CAAR;AAmCA,SACE;AAAe,IAAA,GAAG,EAAEK,KAApB;AAA2B,IAAA,MAAM,EAAE,CAAnC;AAAsC,IAAA,IAAI,EAAE,CAAC,IAAD,EAAO,IAAP,EAAaf,KAAK,CAAC4B,QAAN,CAAemB,MAA5B,CAA5C;AAAiF,IAAA,QAAQ,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,CAA3F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAgB,IAAA,MAAM,EAAC;AAAvB,KAAsC5C,IAAI,CAAC0D,GAAL,CAAS,CAAT,EAAYvD,QAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADF,CADF;AAKD","sourcesContent":["import { WebGLRenderTarget, Object3D } from \"three\"\nimport React, { useRef, useMemo } from \"react\"\nimport { useLoader, useThree, useFrame } from \"react-three-fiber\"\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\"\nimport lerp from \"lerp\"\nimport BackfaceMaterial from \"./BackfaceMaterial\"\nimport RefractionMaterial from \"./RefractionMaterial\"\nimport { useBlock } from \"../blocks\"\nimport state from \"../store\"\n\nconst dummy = new Object3D()\nexport default function Diamonds() {\n  const gltf = useLoader(GLTFLoader, \"/diamond.glb\")\n  useMemo(() => gltf.scene.children[0].geometry.center(), [])\n\n  const { size, gl, scene, camera, clock } = useThree()\n  const { contentMaxWidth, sectionHeight, mobile } = useBlock()\n  const model = useRef()\n  const ratio = gl.getPixelRatio()\n\n  const [envFbo, backfaceFbo, backfaceMaterial, refractionMaterial] = useMemo(() => {\n    const envFbo = new WebGLRenderTarget(size.width * ratio, size.height * ratio)\n    const backfaceFbo = new WebGLRenderTarget(size.width * ratio, size.height * ratio)\n    const backfaceMaterial = new BackfaceMaterial()\n    const refractionMaterial = new RefractionMaterial({\n      envMap: envFbo.texture,\n      backfaceMap: backfaceFbo.texture,\n      resolution: [size.width * ratio, size.height * ratio]\n    })\n    return [envFbo, backfaceFbo, backfaceMaterial, refractionMaterial]\n  }, [size, ratio])\n\n  useFrame(() => {\n    state.diamonds.forEach((data, i) => {\n      const t = clock.getElapsedTime() / 2\n      const { x, offset, scale, factor } = data\n      const s = (contentMaxWidth / 35) * scale\n      data.pos.set(mobile ? 0 : x, lerp(data.pos.y, -sectionHeight * offset * factor + (state.top.current / state.zoom) * factor, 0.1), 0)\n      dummy.position.copy(data.pos)\n      if (i === state.diamonds.length - 1) dummy.rotation.set(0, t, 0)\n      else dummy.rotation.set(t, t, t)\n      dummy.scale.set(s, s, s)\n      dummy.updateMatrix()\n      model.current.setMatrixAt(i, dummy.matrix)\n      model.current.instanceMatrix.needsUpdate = true\n    })\n\n    gl.autoClear = false\n    camera.layers.set(0)\n    gl.setRenderTarget(envFbo)\n    gl.clearColor()\n    gl.render(scene, camera)\n    gl.clearDepth()\n    camera.layers.set(1)\n    model.current.material = backfaceMaterial\n    gl.setRenderTarget(backfaceFbo)\n    gl.clearDepth()\n    gl.render(scene, camera)\n    camera.layers.set(0)\n    gl.setRenderTarget(null)\n    gl.render(scene, camera)\n    gl.clearDepth()\n    camera.layers.set(1)\n    model.current.material = refractionMaterial\n    gl.render(scene, camera)\n  }, 1)\n\n  return (\n    <instancedMesh ref={model} layers={1} args={[null, null, state.diamonds.length]} position={[0, 0, 50]}>\n      <bufferGeometry attach=\"geometry\" {...gltf.__$[1].geometry} />\n    </instancedMesh>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}